{% extends "base.html" %}
{% load courses %}

{% block title %} {{ course.title }} {% endblock %}

{% block content %}

<style type="text/css">
  span.checked {
    color: orange;
  }

  .rating-stars span{
    cursor: pointer;
  }
</style>

<section id="page-banner" class="pt-105 pb-110 bg_cover" data-overlay="8" style="background-image: url(images/page-banner-2.jpg)">
  <div class="container">
      <div class="row">
          <div class="col-lg-12">
              <div class="page-banner-cont">
                  <h2>{{ course.title }}</h2>
                  <nav aria-label="breadcrumb">
                      <ol class="breadcrumb">
                          <li class="breadcrumb-item"><a href="/course/home/">Home</a></li>
                          <li class="breadcrumb-item">
                            <a href="
                            {% if is_paid %}
                              {% url 'paid_courses' 1 %} 
                            {% else %}
                              {% url 'free_courses'%}
                            {% endif %}"
                            >
                            {% if is_paid %} Paid {% else %} Free {% endif %}Courses
                          </a>
                          </li>
                          <li class="breadcrumb-item active" aria-current="page">
                          	{{ course.title }}
                          </li>
                      </ol>
                  </nav>
              </div>  <!-- page banner cont -->
          </div>
      </div> <!-- row -->
  </div> <!-- container -->
</section>


<section id="corses-singel" class="pt-90 pb-120 gray-bg">
<div class="container">
    <div class="row">
        <div class="col-lg-8">
            <div class="corses-singel-left mt-30">
                <div class="title">
                    <h3>{{ course.title }}</h3>
                </div> <!-- title -->
                <div class="course-terms">
                    <ul>
                        <li>
                            <div class="teacher-name">
                                <div class="thum">
                                    <img width="50px" height="50px" src="{{ course.instructor.user.profile_image.url }}">
                                </div>
                                <div class="name">
                                    <span>Teacher</span>
                                    <h6>{{ course.instructor.user.full_name }}</h6>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="course-category">
                                <span>Category</span>
                                <h6>{{ course.subject.name }}</h6>
                            </div>
                        </li>
                        <li>
                            <div class="review">
                                <span>Review</span>
                                <ul>
                                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                                    <li class="rating">(20 Reveiws)</li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div> <!-- course terms -->
                
                <div class="corses-singel-image pt-50">
                    <img src="{{ course.image.url }}" alt="Courses">
                </div> <!-- corses singel image -->
                
                <div class="corses-tab mt-30">
                    <ul class="nav nav-justified" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="active" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="true">Overview</a>
                        </li>
                        <li class="nav-item">
                            <a id="curriculam-tab" data-toggle="tab" href="#curriculam" role="tab" aria-controls="curriculam" aria-selected="false">Curriculam</a>
                        </li>
                        <li class="nav-item">
                            <a id="instructor-tab" data-toggle="tab" href="#instructor" role="tab" aria-controls="instructor" aria-selected="false">Instructor</a>
                        </li>
                        <li class="nav-item">
                            <a id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                            <div class="overview-description">
                                <div class="singel-description pt-40">
                                    <h6>Course Summery</h6>
                                    <p>{{ course.description }}</p>
                                </div>
                                <div class="singel-description pt-40">
                                    <h6>Requrements</h6>
                                    <p>{{ course.requirements }}</p>
                                </div>
                            </div> <!-- overview description -->
                        </div>
                        <div class="tab-pane fade" id="curriculam" role="tabpanel" aria-labelledby="curriculam-tab">
                            <div class="curriculam-cont">
                                <div class="title">
                                    <h6>Learn basis javascirpt Lecture Started</h6>
                                </div>
                                <div class="accordion" id="accordionExample">
                                    <div class="card">
                                        <div class="card-header" id="headingOne">
                                            <a href="#" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                <ul>
                                                    <li><i class="fa fa-file-o"></i></li>
                                                    <li><span class="lecture">Lecture 1.1</span></li>
                                                    <li><span class="head">What is javascirpt</span></li>
                                                    <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> 00.30.00</span></span></li>
                                                </ul>
                                            </a>
                                        </div>

                                        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <p>Ut quis scelerisque risus, et viverra nisi. Phasellus ultricies luctus augue, eget maximus felis laoreet quis. Maecenasbibendum tempor eros.</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card">
                                        <div class="card-header" id="headingTow">
                                            <a href="#" data-toggle="collapse" class="collapsed" data-target="#collapseTow" aria-expanded="true" aria-controls="collapseTow">
                                                <ul>
                                                    <li><i class="fa fa-file-o"></i></li>
                                                    <li><span class="lecture">Lecture 1.2</span></li>
                                                    <li><span class="head">What is javascirpt</span></li>
                                                    <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> 00.30.00</span></span></li>
                                                </ul>
                                            </a>
                                        </div>

                                        <div id="collapseTow" class="collapse" aria-labelledby="headingTow" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <p>Ut quis scelerisque risus, et viverra nisi. Phasellus ultricies luctus augue, eget maximus felis laoreet quis. Maecenasbibendum tempor eros.</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header" id="headingThree">
                                            <a href="#" data-toggle="collapse" class="collapsed" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                                <ul>
                                                    <li><i class="fa fa-file-o"></i></li>
                                                    <li><span class="lecture">Lecture 1.3</span></li>
                                                    <li><span class="head">What is javascirpt</span></li>
                                                    <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> 00.30.00</span></span></li>
                                                </ul>
                                            </a>
                                        </div>
                                        <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <p>Ut quis scelerisque risus, et viverra nisi. Phasellus ultricies luctus augue, eget maximus felis laoreet quis. Maecenasbibendum tempor eros.</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header" id="headingFore">
                                            <a href="#" data-toggle="collapse" class="collapsed" data-target="#collapseFore" aria-expanded="false" aria-controls="collapseFore">
                                                <ul>
                                                    <li><i class="fa fa-file-o"></i></li>
                                                    <li><span class="lecture">Lecture 1.4</span></li>
                                                    <li><span class="head">What is javascirpt</span></li>
                                                    <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> 00.30.00</span></span></li>
                                                </ul>
                                            </a>
                                        </div>
                                        <div id="collapseFore" class="collapse" aria-labelledby="headingFore" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <p>Ut quis scelerisque risus, et viverra nisi. Phasellus ultricies luctus augue, eget maximus felis laoreet quis. Maecenasbibendum tempor eros.</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header" id="headingFive">
                                            <a href="#" data-toggle="collapse" class="collapsed" data-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                                <ul>
                                                    <li><i class="fa fa-file-o"></i></li>
                                                    <li><span class="lecture">Lecture 1.5</span></li>
                                                    <li><span class="head">What is javascirpt</span></li>
                                                    <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> 00.30.00</span></span></li>
                                                </ul>
                                            </a>
                                        </div>
                                        <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <p>Ut quis scelerisque risus, et viverra nisi. Phasellus ultricies luctus augue, eget maximus felis laoreet quis. Maecenasbibendum tempor eros.</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card">
                                        <div class="card-header" id="headingSix">
                                            <a href="#" data-toggle="collapse" class="collapsed" data-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                                <ul>
                                                    <li><i class="fa fa-file-o"></i></li>
                                                    <li><span class="lecture">Lecture 1.6</span></li>
                                                    <li><span class="head">What is javascirpt</span></li>
                                                    <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> 00.30.00</span></span></li>
                                                </ul>
                                            </a>
                                        </div>
                                        <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <p>Ut quis scelerisque risus, et viverra nisi. Phasellus ultricies luctus augue, eget maximus felis laoreet quis. Maecenasbibendum tempor eros.</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card">
                                        <div class="card-header" id="headingSeven">
                                            <a href="#" data-toggle="collapse" class="collapsed" data-target="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
                                                <ul>
                                                    <li><i class="fa fa-file-o"></i></li>
                                                    <li><span class="lecture">Lecture 1.7</span></li>
                                                    <li><span class="head">What is javascirpt</span></li>
                                                    <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> 00.30.00</span></span></li>
                                                </ul>
                                            </a>
                                        </div>
                                        <div id="collapseSeven" class="collapse" aria-labelledby="headingSeven" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <p>Ut quis scelerisque risus, et viverra nisi. Phasellus ultricies luctus augue, eget maximus felis laoreet quis. Maecenasbibendum tempor eros.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- curriculam cont -->
                        </div>
                        <div class="tab-pane fade" id="instructor" role="tabpanel" aria-labelledby="instructor-tab">
                            <div class="instructor-cont">
                                <div class="instructor-author">
                                    <div class="author-thum">
                                        <img width="150px" height="150px" src="{{ course.instructor.user.profile_image.url }}" alt="Instructor">
                                    </div>
                                    <div class="author-name">
                                        <a href="#"><h5>{{ course.instructor.user.full_name }}</h5></a>
                                        <span>Senior WordPress Developer</span>
                                        <ul class="social">
                                            <li><a href="#"><i class="fa fa-facebook-f"></i></a></li>
                                            <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                            <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                            <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="instructor-description pt-25">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Delectus fuga ratione molestiae unde provident quibusdam sunt, doloremque. Error omnis mollitia, ex dolor sequi. Et, quibusdam excepturi. Animi assumenda, consequuntur dolorum odio sit inventore aliquid, optio fugiat alias. Veritatis minima, dicta quam repudiandae repellat non sit, distinctio, impedit, expedita tempora numquam?</p>
                                </div>
                            </div> <!-- instructor cont -->
                        </div>
                        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                            <div class="reviews-cont">
                                <div class="title">
                                    <h6>Student Reviews</h6>
                                </div>
                                <ul class="reviews-list">
                                    {% for review in course.student_reviews.all %}
                                   <li>
                                       <div class="singel-reviews">
                                            <div class="reviews-author">
                                                <div class="author-thum">
                                                    <img src="{{ review.user.profile_image.url }}" width="50" alt="Reviews">
                                                </div>
                                                <div class="author-name">
                                                    <h6>{{ review.user.full_name }}</h6>
                                                    <span>{{ review.date_created.date }}</span>
                                                </div>
                                            </div>
                                            <div class="reviews-description pt-20">
                                                <p>{{ review.comment }}</p>
                                                <div class="rating-block">
                                                    <div>
                                                      {% for i in 5|times %}
                                                        <span 
                                                          class="fa fa-star fa-x2 
                                                          {% if i <= review.rating %}
                                                            checked
                                                          {% endif %}
                                                          ">
                                                              
                                                          </span>
                                                      {% endfor %}
                                                        <span>/ {{ review.rating }} Star</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                   </li>
                                   {% endfor %}
                                </ul>
                                <div class="title pt-15">
                                    <h6>Leave A Comment</h6>
                                </div>
                                <div class="reviews-form">
                                    <form action="#" method="POST" id="review-form">
                                      {% csrf_token %}
                                      <div class="row">
                                        <div class="col-lg-12">
                                          <div class="form-singel">
                                              <div class="rate-wrapper">
                                                <div class="rate-label">Your Rating:</div>
                                                <div class="rating-stars">
                                                  <span class="fa fa-star fa-x2 star-input" id="first"></span>
                                                  <span class="fa fa-star fa-x2 star-input" id="second"></span>
                                                  <span class="fa fa-star fa-x2 star-input" id="third"></span>
                                                  <span class="fa fa-star fa-x2 star-input" id="fourth"></span>
                                                  <span class="fa fa-star fa-x2 star-input" id="fifth"></span>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                            <div class="col-lg-12">
                                                <div class="form-singel">
                                                    <textarea placeholder="Comment" name="review_comment"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="form-singel">
                                                    <input type="submit" class="main-btn" value="Post Comment">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="row">
                <div class="col-lg-12 col-md-6">
                    <div class="course-features mt-30">
                       <h4>Course Features </h4>
                        <ul>
                            <li><i class="fa fa-clock-o"></i>Duaration : <span>10 Hours</span></li>
                            <li><i class="fa fa-clone"></i>Leactures : <span>{{ course.modules.count }}</span></li>
                            <li><i class="fa fa-beer"></i>Quizzes :  <span>{{ course.quizzes.count }}</span></li>
                            <li><i class="fa fa-user-o"></i>Students :  <span>{{ course.students.count }}</span></li>
                        </ul>
                        <div class="price-button pt-10">
                            {% if course.payment_status == 'paid' %}
                                <span>Price : <b>${{ course.price }}</b></span>
                                <button id="add-cart-btn" class="main-btn" data-slug="{{ course.slug }}">Add to Cart</button>
                            {% else  %}
                                <a href="" class="main-btn">Enroll Now</a>
                            {% endif  %}
                            
                        </div>
                    </div> <!-- course features -->
                </div>
                <div class="col-lg-12 col-md-6">
                    <div class="You-makelike mt-30">
                        <h4>You make like </h4> 
                        <div class="singel-makelike mt-20">
                            <div class="image">
                                <img src="images/your-make/y-1.jpg" alt="Image">
                            </div>
                            <div class="cont">
                                <a href="#"><h4>Introduction to machine languages</h4></a>
                                <ul>
                                    <li><a href="#"><i class="fa fa-user"></i>31</a></li>
                                    <li>$50</li>
                                </ul>
                            </div>
                        </div>
                        <div class="singel-makelike mt-20">
                            <div class="image">
                                <img src="images/your-make/y-1.jpg" alt="Image">
                            </div>
                            <div class="cont">
                                <a href="#"><h4>How to build a basis game with java </h4></a>
                                <ul>
                                    <li><a href="#"><i class="fa fa-user"></i>31</a></li>
                                    <li>$50</li>
                                </ul>
                            </div>
                        </div>
                        <div class="singel-makelike mt-20">
                            <div class="image">
                                <img src="images/your-make/y-1.jpg" alt="Image">
                            </div>
                            <div class="cont">
                                <a href="#"><h4>Basic accounting from primary</h4></a>
                                <ul>
                                    <li><a href="#"><i class="fa fa-user"></i>31</a></li>
                                    <li>$50</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8">
            <div class="releted-courses pt-95">
                <div class="title">
                    <h3>Releted Courses</h3>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="singel-course mt-30">
                            <div class="thum">
                                <div class="image">
                                    <img src="images/course/cu-2.jpg" alt="Course">
                                </div>
                                <div class="price">
                                    <span>Free</span>
                                </div>
                            </div>
                            <div class="cont">
                                <ul>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                </ul>
                                <span>(20 Reviws)</span>
                                <a href="courses-singel.html"><h4>Learn basis javascirpt from start for beginner</h4></a>
                                <div class="course-teacher">
                                    <div class="thum">
                                        <a href="#"><img src="images/course/teacher/t-2.jpg" alt="teacher"></a>
                                    </div>
                                    <div class="name">
                                        <a href="#"><h6>Mark anthem</h6></a>
                                    </div>
                                    <div class="admin">
                                        <ul>
                                            <li><a href="#"><i class="fa fa-user"></i><span>31</span></a></li>
                                            <li><a href="#"><i class="fa fa-heart"></i><span>10</span></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- singel course -->
                    </div>
                    <div class="col-md-6">
                        <div class="singel-course mt-30">
                            <div class="thum">
                                <div class="image">
                                    <img src="images/course/cu-1.jpg" alt="Course">
                                </div>
                                <div class="price">
                                    <span>Free</span>
                                </div>
                            </div>
                            <div class="cont">
                                <ul>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                </ul>
                                <span>(20 Reviws)</span>
                                <a href="courses-singel.html"><h4>Learn basis javascirpt from start for beginner</h4></a>
                                <div class="course-teacher">
                                    <div class="thum">
                                        <a href="#"><img src="images/course/teacher/t-3.jpg" alt="teacher"></a>
                                    </div>
                                    <div class="name">
                                        <a href="#"><h6>Mark anthem</h6></a>
                                    </div>
                                    <div class="admin">
                                        <ul>
                                            <li><a href="#"><i class="fa fa-user"></i><span>31</span></a></li>
                                            <li><a href="#"><i class="fa fa-heart"></i><span>10</span></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</section>
{% endblock %}


{% block javascript %}
  <script type="text/javascript">
    document.querySelectorAll('#add-cart-btn').forEach((button) => button.addEventListener('click', addItemToCart));
    
    function addItemToCart (event) {
      const course_slug = this.dataset.slug;

      if (user == "AnonymousUser") {
        if(cart[course_slug] == undefined) {    cart[course_slug] = {}; }
        setCookie('cart', cart, 2);

      } else {
        $.ajax({
            url: `/course/${course_slug}/add-to-cart/`,
            success: function (response) {
                let cart_items = parseInt(document.querySelector('#cart-items').textContent);
                cart_items++;
                document.querySelector('#cart-items').textContent = cart_items;
                event.target.remove();
            },
            error: function (response) {
                console.log('something went wrong');
            }
        });
      }
    }

    console.log('LOGIC IS GOING TO EXECUTE');

    const stars = document.querySelectorAll('.star-input');
    var rating_value = 0;

    stars.forEach(star => {
      star.addEventListener('mouseover', (event) => {
        handleSelect(event.target.id);
      });
    });

    function handleSelect(star_id){
      switch (star_id) {
        case "first":
          selectStars(1)
          rating_value = 1
          return;
        case "second":
          selectStars(2)
          rating_value = 2
          return;
        case "third":
          selectStars(3)
          rating_value = 3
          return;
        case "fourth":
          selectStars(4)
          rating_value = 4
          return;
        case "fifth":
          selectStars(5)
          rating_value = 5
          return;
      }
    }

    function selectStars(size) {
      for(let i = 1; i <= stars.length; i++) {
        if(i <= size) {
          stars[i-1].classList.add('checked');
        } else {
          stars[i-1].classList.remove('checked');
        }
      }
    }

    document.querySelector('#review-form').addEventListener('submit', (event) => {
      event.preventDefault();

      const review_comment = event.target.review_comment.value;
      const url = "/course/{{ course.slug }}/review/";

      const data = new FormData();
      data.append('csrfmiddlewaretoken', '{{ csrf_token }}');
      data.append('rating', rating_value);
      data.append('comment', review_comment);

      axios.post(url, data)
      .then(response => {
        const review_data = response.data;
        console.log(review_data);
        createAndAppendNewDOMReview(review_data);
        event.target.review_comment.value = "";     // empty the field
        // uncheck all stars
        stars.forEach(star => { star.classList.remove('checked')});

      })
      .catch(err => {
        console.error(err);
      });
    });

    function createAndAppendNewDOMReview(review_data) {
      const new_review_li = document.createElement('li');

      var stars = '';

      for(let i = 1; i <= 5; i++) {
        if(i <= review_data.rating) {
            stars += `
                <span class="fa fa-star fa-x2 checked"></span>
            `    
        } else {
            stars += `
                <span class="fa fa-star fa-x2"></span>
            `
        }
      }

      new_review_li.innerHTML = `
        <div class="singel-reviews">
          <div class="reviews-author">
              <div class="author-thum">
                  <img src="${review_data.profile_image}" width="50" alt="Reviews">
              </div>
              <div class="author-name">
                  <h6>${review_data.username}</h6>
                  <span>${review_data.date_created}</span>
              </div>
          </div>
          <div class="reviews-description pt-20">
              <p>${review_data.comment}</p>
              <div class="rating-block">
                  <div>
                    ${stars}
                    <span>/ ${review_data.rating} Star</span>
                  </div>
              </div>
          </div>
      </div>
      `;
      document.querySelector('.reviews-list').appendChild(new_review_li);
    }
  </script>
{% endblock %}